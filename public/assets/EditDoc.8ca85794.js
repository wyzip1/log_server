import{r as e,k as a,f as t,g as l,q as s,F as n,m as o,s as u,v as r,l as i,p as c,b as d,d as v,u as p,o as m,t as g}from"./vendor.da39e7fd.js";import{m as f,E as h}from"./index.3f82e5e8.js";import{_ as y,a as b}from"./Button.5ceeb0fb.js";import{g as k}from"./type.90d2ee65.js";import{a as I,b as S}from"./chapter.13c42637.js";import"./util.cdae3ab6.js";const _=(e,a=300)=>{let t;return(...l)=>{t&&clearTimeout(t),t=setTimeout((()=>{"function"==typeof e&&e(...l),t=void 0}),a)}};c("data-v-c0da08c0");const j={class:"container"},w={class:"head"},x={class:"footer"};d();const M={expose:[],setup(c){const d=v(),M=p(),C=e(),O=e(),V=e(),q=e(),E=e(),J=e("提交");a((async()=>{const e=new f.Renderer;f.setOptions({renderer:e,highlight:function(e){return h.highlightAuto(e).value},gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1});let a=await k();V.value=a.meta.data;let t,{mode:l,chapterId:s}=M.query;if(l){J.value="更新",t=(await I(s)).meta.data}else t=JSON.parse(localStorage.getItem("editMarked")||"[]");C.value=t.content||"",q.value=t.title||"",E.value=t.typeId||V.value[0]._id,K()}));const N=_((()=>{K(),M.query.mode||T()}),600),T=_((()=>{localStorage.setItem("editMarked",JSON.stringify({title:q.value,typeId:E.value,content:C.value})),console.log("save to localStorage at editMarked")}),600);function K(){O.value.innerHTML=f(C.value).replace(/<pre>/g,"<pre class='hljs'>")}function L({target:e}){E.value=e.value,T()}function U(){let e=JSON.parse(localStorage.getItem("userInfo"))._id;S({title:q.value,typeId:E.value,content:C.value,userId:e}).then((e=>{console.log(e),localStorage.setItem("editMarked",""),alert("提交文章成功")}))}function z(){d.back()}function A(e){if(9===(e.keyCode||e.which)){e.preventDefault();var a=e.target.selectionStart,t=e.target.selectionEnd;e.target.value=e.target.value.substring(0,a)+"\t"+e.target.value.substring(t),e.target.selectionStart=e.target.selectionEnd=a+1}}return(e,a)=>(m(),t("div",j,[l("div",w,[l(y,{placeholder:"请输入标题",class:"title",modelValue:q.value,"onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e),onInput:s(T)},null,8,["modelValue","onInput"])]),l("div",{onChange:L,style:{"min-height":"21px"}},[(m(!0),t(n,null,o(V.value,(e=>(m(),t("label",{key:e._id,class:"type"},[l("input",{type:"radio",value:e._id,name:"type",checked:E.value===e._id},null,8,["value","checked"]),l("span",null,g(e.name),1)])))),128))],32),l("section",null,[u(l("textarea",{placeholder:"请写点什么......","onUpdate:modelValue":a[2]||(a[2]=e=>C.value=e),onInput:a[3]||(a[3]=(...e)=>s(N)&&s(N)(...e)),onKeydown:i(A,["tab"]),class:"edit"},null,40,["onKeydown"]),[[r,C.value]]),l("div",{class:"show",ref:O},null,512)]),l("div",x,[l(b,{class:"submit",value:J.value,onClick:U},null,8,["value"]),l(b,{value:"返回",class:"back",onClick:z})])]))},__scopeId:"data-v-c0da08c0"};export default M;
